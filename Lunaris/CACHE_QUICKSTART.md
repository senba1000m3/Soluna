# 聲優快取功能 - 快速開始指南

## 🚀 5 分鐘快速上手

### 步驟 1: 初始化資料庫

首次使用前，啟動你的 FastAPI 應用即可自動初始化資料庫表：

```bash
cd Lunaris
python -m uvicorn main:app --reload
```

或手動初始化：

```python
from database import init_db

init_db()  # 會自動建立 AnimeVoiceActorCache 表
```

### 步驟 2: 測試快取功能

執行測試腳本來驗證快取是否正常工作：

```bash
python test_voice_actor_cache.py
```

你應該會看到類似以下的輸出：

```
🧪 測試 1: 第一次抓取 (應該從 API 抓取)
🎤 [AniList Client] 從 API 抓取動漫聲優資料: 16498
⏱️  第一次抓取耗時: 0.85 秒
✅ 成功取得資料，共 25 個角色

🧪 測試 2: 第二次抓取 (應該從快取讀取)
💾 [AniList Client] 使用快取資料: 動漫 16498
⏱️  第二次抓取耗時: 0.01 秒
✅ 成功從快取讀取資料，共 25 個角色

📊 效能比較
第一次抓取 (從 API):  0.85 秒
第二次抓取 (從快取): 0.01 秒
🚀 快取加速: 85.00x 倍
💾 節省時間: 0.84 秒
```

### 步驟 3: 在你的程式碼中使用

快取功能已經整合到 `/recap` 端點中，無需額外設定！

當用戶第二次查詢 Recap 時，速度會快 **80-90 倍**！

## 📊 查看快取狀態

查看目前的快取統計：

```bash
python manage_cache.py stats
```

輸出範例：

```
📊 快取統計資訊
總快取數量: 150
總快取大小: 4.85 MB
平均大小: 33.12 KB

最新快取: 動漫 16498 (2024-01-15 14:30:25)
最舊快取: 動漫 1535 (2024-01-10 09:15:42)

快取年齡分布:
  < 1 天    :   45 (30.0%) ███████████████
  1-7 天    :   68 (45.3%) ██████████████████████
  7-30 天   :   30 (20.0%) ██████████
  > 30 天   :    7 ( 4.7%) ██
```

## 🗂️ 常用管理指令

```bash
# 列出所有快取
python manage_cache.py list

# 查看特定動漫的快取詳情
python manage_cache.py show 16498

# 刪除特定動漫的快取
python manage_cache.py delete 16498

# 清理超過 30 天的快取
python manage_cache.py clean --days 30

# 匯出快取列表
python manage_cache.py export cache_list.csv
```

## ✅ 驗證快取已啟用

訪問 `/recap` 端點並觀察 console 輸出：

**第一次查詢**：
```
🎤 [AniList Client] 從 API 抓取動漫聲優資料: 16498
💾 [AniList Client] 儲存快取: 動漫 16498
```

**第二次查詢**：
```
💾 [AniList Client] 使用快取資料: 動漫 16498 (快取時間: 2024-01-15 14:30:25)
```

## 🎯 效能對比

以包含 100 部動漫的 Recap 為例：

| 查詢次數 | 耗時 | 說明 |
|---------|------|------|
| 第 1 次 | ~90 秒 | 從 API 抓取，儲存快取 |
| 第 2 次 | ~1 秒 | 從快取讀取 ⚡ |