# BERT4Rec å¿«é€Ÿé–‹å§‹æŒ‡å—

> 5 åˆ†é˜å¿«é€Ÿä¸Šæ‰‹ BERT4Rec å‹•ç•«æ¨è–¦æ¨¡å‹è¨“ç·´

## ğŸš€ æœ€å¿«é–‹å§‹æ–¹å¼

### ä¸€éµåŸ·è¡Œï¼ˆæ¨è–¦ï¼‰

```bash
# 1. è¨­ç½®ç’°å¢ƒ
setup.bat

# 2. åŸ·è¡Œå®Œæ•´è¨“ç·´æµç¨‹
run_all.bat
```

å®Œæˆï¼å°±æ˜¯é€™éº¼ç°¡å–® ğŸ‰

---

## ğŸ“‹ åˆ†æ­¥åŸ·è¡Œï¼ˆæ›´å¤šæ§åˆ¶ï¼‰

### æ­¥é©Ÿ 0: ç’°å¢ƒè¨­ç½®

```bash
# å®‰è£ä¾è³´ä¸¦å‰µå»ºç›®éŒ„çµæ§‹
setup.bat
```

### æ­¥é©Ÿ 1: æº–å‚™å‹•ç•«æ•¸æ“š

```bash
# æŠ“å– 3000 éƒ¨ç†±é–€å‹•ç•«
1_prepare_anime.bat
```

**é è¨ˆæ™‚é–“**: 10-20 åˆ†é˜  
**è¼¸å‡º**: `data/bert.db` (åŒ…å« 3000 éƒ¨å‹•ç•«)

### æ­¥é©Ÿ 2: è¼‰å…¥ç”¨æˆ¶æ•¸æ“š

```bash
# å¾ datas_user.txt è¼‰å…¥ç”¨æˆ¶è§€çœ‹è¨˜éŒ„
2_load_users.bat
```

**é è¨ˆæ™‚é–“**: 5-15 åˆ†é˜ï¼ˆå–æ±ºæ–¼ç”¨æˆ¶æ•¸é‡ï¼‰  
**è¼¸å‡º**: ç”¨æˆ¶è§€çœ‹è¨˜éŒ„æ·»åŠ åˆ° `data/bert.db`

### æ­¥é©Ÿ 3: è¨“ç·´æ¨¡å‹

```bash
# CPU ç‰ˆæœ¬
3_train_model.bat

# GPU ç‰ˆæœ¬ï¼ˆå¦‚æœæœ‰ NVIDIA GPUï¼‰
3_train_model_gpu.bat
```

**é è¨ˆæ™‚é–“**: 
- CPU: 2-6 å°æ™‚ï¼ˆ200 epochsï¼‰
- GPU: 30 åˆ†é˜ - 2 å°æ™‚

**è¼¸å‡º**: 
- æ¨¡å‹: `output/models/best_model.pth`
- åœ–è¡¨: `output/plots/*.png`
- æ—¥èªŒ: `training.log`

---

## ğŸ“Š æŸ¥çœ‹è¨“ç·´çµæœ

### 1. æŸ¥çœ‹è¦–è¦ºåŒ–åœ–è¡¨

```bash
# Windows è³‡æ–™å¤¾
start output\plots

# é‡é»æŸ¥çœ‹é€™å€‹ç¶œåˆåœ–è¡¨
start output\plots\combined_metrics.png
```

### 2. æŸ¥çœ‹è¨“ç·´æŒ‡æ¨™

```bash
# æŸ¥çœ‹å®Œæ•´ JSON æ ¼å¼æŒ‡æ¨™
notepad output\plots\training_metrics.json

# æŸ¥çœ‹æ—¥èªŒ
notepad training.log
```

### 3. åœ–è¡¨èªªæ˜

- **loss_curve.png**: Loss æ›²ç·šï¼Œæ‡‰è©²é€æ¼¸ä¸‹é™
- **accuracy_curve.png**: æº–ç¢ºç‡æ›²ç·šï¼Œæ‡‰è©²é€æ¼¸ä¸Šå‡
- **combined_metrics.png**: ç¶œåˆæŒ‡æ¨™ï¼Œä¸€æ¬¡çœ‹æ¸…æ‰€æœ‰é‡è¦æ•¸æ“š
- **learning_curve.png**: å¹³æ»‘çš„å­¸ç¿’æ›²ç·š

---

## âš™ï¸ è‡ªè¨‚è¨“ç·´åƒæ•¸

### ä¿®æ”¹é…ç½®æ–‡ä»¶

ç·¨è¼¯ `config.py`:

```python
# è¨“ç·´åƒæ•¸
epochs: 200              # æ”¹æˆ 100 å¯ä»¥æ›´å¿«å®Œæˆ
batch_size: 64          # å¦‚æœè¨˜æ†¶é«”ä¸è¶³ï¼Œæ”¹æˆ 32
learning_rate: 1e-3     # å­¸ç¿’ç‡

# æ¨¡å‹åƒæ•¸
hidden_size: 256        # æ¨¡å‹å¤§å°
num_layers: 2          # Transformer å±¤æ•¸
```

### ä½¿ç”¨å‘½ä»¤åˆ—åƒæ•¸

```bash
# å¿«é€Ÿæ¸¬è©¦ï¼ˆ50 epochsï¼‰
python train_model.py --epochs 50 --batch-size 32

# å®Œæ•´è¨“ç·´ï¼ˆ200 epochs, GPUï¼‰
python train_model.py --epochs 200 --batch-size 128 --gpu

# å¤§æ¨¡å‹è¨“ç·´
python train_model.py --epochs 200 --hidden-size 512 --num-layers 4 --gpu
```

---

## ğŸ”§ å¸¸è¦‹å•é¡Œé€ŸæŸ¥

### âŒ æ‰¾ä¸åˆ° Python
**è§£æ±º**: å®‰è£ Python 3.8+ from https://www.python.org/downloads/

### âŒ å¥—ä»¶å®‰è£å¤±æ•—
```bash
# ä½¿ç”¨åœ‹å…§é¡åƒï¼ˆå¦‚æœåœ¨ä¸­åœ‹ï¼‰
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### âŒ GPU ä¸å¯ç”¨ä½†æˆ‘æœ‰ NVIDIA GPU
```bash
# å®‰è£ CUDA ç‰ˆæœ¬çš„ PyTorch
pip install torch torchvision --index-url https://download.pytorch.org/whl/cu118
```

### âŒ è¨˜æ†¶é«”ä¸è¶³
```bash
# æ¸›å°‘ batch size
python train_model.py --batch-size 32

# æˆ–æ¸›å°‘åºåˆ—é•·åº¦
python train_model.py --max-seq-len 100
```

### âŒ è³‡æ–™åº«ç‚ºç©º
**ç¢ºä¿æŒ‰é †åºåŸ·è¡Œ**: 
1. `1_prepare_anime.bat` (å…ˆ)
2. `2_load_users.bat` (å¾Œ)
3. `3_train_model.bat` (æœ€å¾Œ)

### âš ï¸ æº–ç¢ºç‡å¾ˆä½ï¼ˆ<5%ï¼‰
**å¯èƒ½åŸå› **:
- æ•¸æ“šå¤ªå°‘ï¼šå¢åŠ æ›´å¤šç”¨æˆ¶åˆ° `datas_user.txt`
- è¨“ç·´ä¸è¶³ï¼šå¢åŠ  epochs
- æ¨¡å‹å¤ªå°ï¼šå¢åŠ  `hidden_size`

---

## ğŸ“ˆ é æœŸçµæœ

### è‰¯å¥½çš„è¨“ç·´çµæœæ‡‰è©²ï¼š

âœ… **Loss**: å¾ 8-10 é™åˆ° 3-5  
âœ… **Top-1 Acc**: 10-20%  
âœ… **Top-5 Acc**: 25-40%  
âœ… **Top-10 Acc**: 35-55%  
âœ… **Top-20 Acc**: 45-65%  

### å¦‚æœçµæœä¸ç†æƒ³ï¼š

1. å¢åŠ è¨“ç·´æ•¸æ“šï¼ˆæ›´å¤šç”¨æˆ¶ï¼‰
2. å¢åŠ è¨“ç·´è¼ªæ•¸ï¼ˆ300-500 epochsï¼‰
3. èª¿æ•´å­¸ç¿’ç‡ï¼ˆè©¦è©¦ 0.0005 æˆ– 0.002ï¼‰
4. å¢å¤§æ¨¡å‹ï¼ˆ`--hidden-size 512 --num-layers 4`ï¼‰

---

## ğŸ¯ æœ€ä½³å¯¦è¸

### é¦–æ¬¡è¨“ç·´å»ºè­°

```bash
# å¿«é€Ÿæ¸¬è©¦ï¼ˆé©—è­‰ç’°å¢ƒï¼‰
python train_model.py --epochs 10 --batch-size 32

# æ­£å¼è¨“ç·´ï¼ˆå¦‚æœæ¸¬è©¦é€šéï¼‰
python train_model.py --epochs 200 --batch-size 64 --gpu
```

### æ•¸æ“šæº–å‚™å»ºè­°

- **ç”¨æˆ¶æ•¸é‡**: è‡³å°‘ 50-100 å€‹ç”¨æˆ¶
- **æ¯ç”¨æˆ¶å‹•ç•«æ•¸**: è‡³å°‘ 20 éƒ¨ï¼ˆ`--min-anime 20`ï¼‰
- **å‹•ç•«ç¸½æ•¸**: 3000 éƒ¨ï¼ˆå·²è¶³å¤ ï¼‰

### GPU ä½¿ç”¨å»ºè­°

å¦‚æœæœ‰ NVIDIA GPUï¼ˆGTX 1060 6GB ä»¥ä¸Šï¼‰:
```bash
python train_model.py --epochs 200 --batch-size 128 --gpu
```

å¦‚æœ GPU è¨˜æ†¶é«”ä¸è¶³:
```bash
python train_model.py --epochs 200 --batch-size 64 --gpu
```

---

## ğŸ“ é …ç›®çµæ§‹ä¸€è¦½

```
bert_training/
â”œâ”€â”€ setup.bat                    # â† å¾é€™è£¡é–‹å§‹
â”œâ”€â”€ run_all.bat                  # â† æˆ–ç›´æ¥åŸ·è¡Œé€™å€‹
â”œâ”€â”€ 1_prepare_anime.bat          # æ­¥é©Ÿ 1
â”œâ”€â”€ 2_load_users.bat             # æ­¥é©Ÿ 2
â”œâ”€â”€ 3_train_model.bat            # æ­¥é©Ÿ 3 (CPU)
â”œâ”€â”€ 3_train_model_gpu.bat        # æ­¥é©Ÿ 3 (GPU)
â”œâ”€â”€ config.py                    # é…ç½®æ–‡ä»¶
â”œâ”€â”€ train_model.py               # ä¸»è¨“ç·´è…³æœ¬
â”œâ”€â”€ visualize.py                 # è¦–è¦ºåŒ–å·¥å…·
â”œâ”€â”€ datas_user.txt              # ç”¨æˆ¶åå–®ï¼ˆå¯ç·¨è¼¯ï¼‰
â””â”€â”€ output/
    â”œâ”€â”€ models/                  # â† è¨“ç·´å¥½çš„æ¨¡å‹åœ¨é€™è£¡
    â”œâ”€â”€ plots/                   # â† è¨“ç·´åœ–è¡¨åœ¨é€™è£¡
    â””â”€â”€ checkpoints/             # â† è¨“ç·´æª¢æŸ¥é»
```

---

## ğŸ“ ä¸‹ä¸€æ­¥

è¨“ç·´å®Œæˆå¾Œ:

1. **æŸ¥çœ‹çµæœ**: æª¢æŸ¥ `output/plots/combined_metrics.png`
2. **ä½¿ç”¨æ¨¡å‹**: å°‡ `output/models/best_model.pth` æ•´åˆåˆ°æ¨è–¦ç³»çµ±
3. **ç¹¼çºŒå„ªåŒ–**: æ ¹æ“šçµæœèª¿æ•´åƒæ•¸ä¸¦é‡æ–°è¨“ç·´

---

## ğŸ’¡ å°æç¤º

- â±ï¸ è¨“ç·´å¯ä»¥éš¨æ™‚æŒ‰ `Ctrl+C` ä¸­æ–·
- ğŸ’¾ æ¯ 10 å€‹ epoch è‡ªå‹•å„²å­˜æª¢æŸ¥é»
- ğŸ“Š åœ–è¡¨åœ¨è¨“ç·´çµæŸå¾Œè‡ªå‹•ç”Ÿæˆ
- ğŸ”„ å¦‚æœä¸­æ–·ï¼Œé‡æ–°é‹è¡Œæœƒå¾é ­é–‹å§‹ï¼ˆæš«ä¸æ”¯æŒçºŒè¨“ï¼‰

---

## ğŸ“ éœ€è¦å¹«åŠ©ï¼Ÿ

è©³ç´°æ–‡æª”è«‹æŸ¥çœ‹:
- **å®Œæ•´èªªæ˜**: `README.md`
- **é…ç½®èªªæ˜**: `config.py`
- **è¨“ç·´è…³æœ¬**: `train_model.py`

---

**ç¥è¨“ç·´é †åˆ©ï¼** ğŸš€