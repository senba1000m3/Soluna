@echo off
chcp 65001 > nul
echo ================================================================================
echo BERT4Rec å®Œæ•´è¨“ç·´æµç¨‹
echo ================================================================================
echo.
echo æ­¤è…³æœ¬æœƒä¾åºåŸ·è¡Œä»¥ä¸‹æ­¥é©Ÿï¼š
echo   1. æº–å‚™å‹•ç•«æ•¸æ“šï¼ˆæŠ“å– 3000 éƒ¨ç†±é–€å‹•ç•«ï¼‰
echo   2. è¼‰å…¥ç”¨æˆ¶æ•¸æ“šï¼ˆå¾ datas_user.txtï¼‰
echo   3. è¨“ç·´ BERT4Rec æ¨¡å‹ï¼ˆ200 epochsï¼‰
echo.
echo âš ï¸  æ³¨æ„ï¼šæ•´å€‹æµç¨‹å¯èƒ½éœ€è¦æ•¸å°æ™‚å®Œæˆ
echo.
echo ================================================================================
echo.

choice /C YN /M "ç¢ºå®šè¦é–‹å§‹å®Œæ•´è¨“ç·´æµç¨‹å—ï¼Ÿ"
if errorlevel 2 goto :cancel
if errorlevel 1 goto :start

:start
echo.
echo ================================================================================
echo ç¬¬ 1 æ­¥ï¼šæº–å‚™å‹•ç•«æ•¸æ“š
echo ================================================================================
echo.
python prepare_dataset.py --count 3000
if errorlevel 1 (
    echo.
    echo âŒ æ­¥é©Ÿ 1 å¤±æ•—ï¼è«‹æª¢æŸ¥éŒ¯èª¤è¨Šæ¯
    goto :error
)

echo.
echo âœ… æ­¥é©Ÿ 1 å®Œæˆï¼
echo.
timeout /t 3 /nobreak > nul

echo.
echo ================================================================================
echo ç¬¬ 2 æ­¥ï¼šè¼‰å…¥ç”¨æˆ¶æ•¸æ“š
echo ================================================================================
echo.
python load_users.py --min-anime 20
if errorlevel 1 (
    echo.
    echo âŒ æ­¥é©Ÿ 2 å¤±æ•—ï¼è«‹æª¢æŸ¥éŒ¯èª¤è¨Šæ¯
    goto :error
)

echo.
echo âœ… æ­¥é©Ÿ 2 å®Œæˆï¼
echo.
timeout /t 3 /nobreak > nul

echo.
echo ================================================================================
echo ç¬¬ 3 æ­¥ï¼šè¨“ç·´æ¨¡å‹ï¼ˆ200 epochsï¼‰
echo ================================================================================
echo.
echo é–‹å§‹è¨“ç·´... é€™å¯èƒ½éœ€è¦å¹¾å€‹å°æ™‚
echo.
python train_model.py --epochs 200 --batch-size 64 --lr 0.001
if errorlevel 1 (
    echo.
    echo âŒ æ­¥é©Ÿ 3 å¤±æ•—ï¼è«‹æª¢æŸ¥éŒ¯èª¤è¨Šæ¯
    goto :error
)

echo.
echo âœ… æ­¥é©Ÿ 3 å®Œæˆï¼
echo.

echo.
echo ================================================================================
echo ğŸ‰ æ‰€æœ‰æ­¥é©Ÿå®Œæˆï¼
echo ================================================================================
echo.
echo è¨“ç·´çµæœä½ç½®ï¼š
echo   ğŸ“ æ¨¡å‹æ–‡ä»¶: output/models/
echo      - best_model.pth (æœ€ä½³æ¨¡å‹)
echo      - final_model.pth (æœ€çµ‚æ¨¡å‹)
echo      - item_mappings.pkl (æ˜ å°„è³‡æ–™)
echo.
echo   ğŸ“Š è¨“ç·´åœ–è¡¨: output/plots/
echo      - combined_metrics.png (ç¶œåˆæŒ‡æ¨™åœ–)
echo      - loss_curve.png (Loss æ›²ç·š)
echo      - accuracy_curve.png (æº–ç¢ºç‡æ›²ç·š)
echo      - learning_curve.png (å­¸ç¿’æ›²ç·š)
echo      - training_metrics.json (å®Œæ•´æŒ‡æ¨™)
echo.
echo   ğŸ“ è¨“ç·´æ—¥èªŒ: training.log
echo.
echo ä¸‹ä¸€æ­¥ï¼š
echo   1. æŸ¥çœ‹ output/plots/combined_metrics.png äº†è§£è¨“ç·´æ•ˆæœ
echo   2. ä½¿ç”¨è¨“ç·´å¥½çš„æ¨¡å‹é€²è¡Œæ¨è–¦
echo.
goto :end

:cancel
echo.
echo å·²å–æ¶ˆåŸ·è¡Œ
goto :end

:error
echo.
echo ================================================================================
echo âŒ åŸ·è¡Œéç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤
echo ================================================================================
echo.
echo è«‹æª¢æŸ¥ï¼š
echo   1. æ˜¯å¦å·²å®‰è£æ‰€æœ‰ä¾è³´å¥—ä»¶ï¼ˆpip install -r requirements.txtï¼‰
echo   2. æ˜¯å¦æœ‰ç¶²è·¯é€£ç·šï¼ˆéœ€è¦é€£æ¥ AniList APIï¼‰
echo   3. datas_user.txt æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”æ ¼å¼æ­£ç¢º
echo   4. æª¢æŸ¥ training.log æŸ¥çœ‹è©³ç´°éŒ¯èª¤ä¿¡æ¯
echo.
goto :end

:end
pause
